<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="ParmEd : Amber OpenMM Examples" />

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">

    <title>ParmEd</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/swails/ParmEd">View on GitHub</a>

          <h1><a href="../../index.html">ParmEd</a></h1>
          <h2 id="project_tagline">Amber OpenMM Examples</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="examples-using-amber-files" class="anchor" href="#examples-using-amber-files"><span class="octicon octicon-link"></span></a>Examples using AMBER Files</h1>

<p>There are popular ways to model biomolecular systems.  Because solvation effects are often (always?) critically important to biological function, we need some way to model the solvent.  The two popular approaches are to employ a continuum model with a dielectric constant equal to that of the bulk solvent or to model the solvent models directly in your system.  These two approaches are termed <em>implicit</em> and <em>explicit</em> solvation, respectively.</p>

<p>The next 2 sections present examples using a Generalized Born implicit solvent model and explicit solvent based on the TIP3P water model. All of the files and examples here are included in the <code>examples/amber</code> directory of the ParmEd release.</p>

<h2>
<a name="generalized-born-implicit-solvent" class="anchor" href="#generalized-born-implicit-solvent"><span class="octicon octicon-link"></span></a>Generalized Born Implicit Solvent</h2>

<p>For the purposes of this example, we are using an alanine pentapeptide.  You can download the files using the following links (or see the same files in the <code>examples/amber</code> directory of the ParmEd release):</p>

<ul>
<li>
<a href="ala5_gas.parm7">ala5_gas.parm7</a> : The input parameter/topology file</li>
<li>
<a href="ala5_gas.rst7">ala5_gas.rst7</a> : The input coordinate file</li>
</ul><p>The following sample script (<code>simulate_amber_gb.py</code> in the ParmEd release) will set up and run the simulation using OpenMM:</p>

<div class="highlight highlight-Python"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># OpenMM Imports</span>
<span class="kn">import</span> <span class="nn">simtk.unit</span> <span class="kn">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">simtk.openmm</span> <span class="kn">as</span> <span class="nn">mm</span>
<span class="kn">import</span> <span class="nn">simtk.openmm.app</span> <span class="kn">as</span> <span class="nn">app</span>

<span class="c"># ParmEd Imports</span>
<span class="kn">from</span> <span class="nn">chemistry.amber.openmmloader</span> <span class="kn">import</span> <span class="n">OpenMMAmberParm</span> <span class="k">as</span> <span class="n">AmberParm</span>
<span class="kn">from</span> <span class="nn">chemistry.amber.openmmreporters</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">AmberStateDataReporter</span><span class="p">,</span> <span class="n">NetCDFReporter</span><span class="p">)</span>

<span class="c"># Load the CHARMM files</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Loading Amber files...'</span><span class="p">)</span>
<span class="n">ala5_gas</span> <span class="o">=</span> <span class="n">AmberParm</span><span class="p">(</span><span class="s">'ala5_gas.parm7'</span><span class="p">,</span> <span class="s">'ala5_gas.rst7'</span><span class="p">)</span>

<span class="c"># Create the OpenMM system</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Creating OpenMM System'</span><span class="p">)</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">ala5_gas</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">nonbondedMethod</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">NoCutoff</span><span class="p">,</span>
                               <span class="n">constraints</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">HBonds</span><span class="p">,</span> <span class="n">implicitSolvent</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">GBn2</span><span class="p">,</span>
                               <span class="n">implicitSolventSaltConc</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">moles</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">liter</span><span class="p">,</span>
<span class="p">)</span>

<span class="c"># Create the integrator to do Langevin dynamics</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">LangevinIntegrator</span><span class="p">(</span>
                        <span class="mi">300</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span>       <span class="c"># Temperature of heat bath</span>
                        <span class="mf">1.0</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">,</span>  <span class="c"># Friction coefficient</span>
                        <span class="mf">2.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">femtoseconds</span><span class="p">,</span> <span class="c"># Time step</span>
<span class="p">)</span>

<span class="c"># Define the platform to use; CUDA, OpenCL, CPU, or Reference. Or do not specify</span>
<span class="c"># the platform to use the default (fastest) platform</span>
<span class="n">platform</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">Platform</span><span class="o">.</span><span class="n">getPlatformByName</span><span class="p">(</span><span class="s">'CUDA'</span><span class="p">)</span>
<span class="n">prop</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">CudaPrecision</span><span class="o">=</span><span class="s">'mixed'</span><span class="p">)</span> <span class="c"># Use mixed single/double precision</span>

<span class="c"># Create the Simulation object</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">ala5_gas</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">,</span> <span class="n">platform</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>

<span class="c"># Set the particle positions</span>
<span class="n">sim</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">ala5_gas</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>

<span class="c"># Minimize the energy</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Minimizing energy'</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">minimizeEnergy</span><span class="p">(</span><span class="n">maxIterations</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="c"># Set up the reporters to report energies and coordinates every 100 steps</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">AmberStateDataReporter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">potentialEnergy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                               <span class="n">kineticEnergy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">NetCDFReporter</span><span class="p">(</span><span class="s">'ala5_gb.nc'</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">crds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="c"># Run dynamics</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Running dynamics'</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>

<p>Now we'll dissect the script to help you understand what is happening at each step.  We will divide the script into the sections following the <code>print</code> statements that announce when each stage begins.</p>

<h3>
<a name="loading-amber-files" class="anchor" href="#loading-amber-files"><span class="octicon octicon-link"></span></a>Loading Amber files</h3>

<p>In this stage, we simply instantiate the <code>AmberParm</code> object from the input topology and coordinate files. After this command, <code>ala5_gas</code> will contain a full description of every particle, the parameters defining their interactions, and their positions.</p>

<h3>
<a name="create-the-openmm-system" class="anchor" href="#create-the-openmm-system"><span class="octicon octicon-link"></span></a>Create the OpenMM system</h3>

<p>This command creates an OpenMM <code>System</code> object from the information stored in <code>ala5_gas</code>. It contains multiple <code>Force</code> instances for the bonds, angles, periodic torsions, and nonbonded (electrostatic and van der Waals) interactions.  It is in this function that we define the potential parameters we want to use. In this example, we have chosen the default values for each parameter except the ones specified. In particular:</p>

<ul>
<li>
<code>nonbondedMethod=app.NoCutoff</code> indicates we do not want to use a cutoff for nonbonded interactions</li>
<li>
<code>constraints=app.HBonds</code> indicates that we want to constrain all bonds in which at least one atom is hydrogen</li>
<li>
<code>implicitSolvent=app.GBn2</code> indicates that we want to use the second GBneck model described in Nguyen et al., J. Chem. Theory Comput., 2013, 9(4) p. 2020-2034.</li>
<li>
<code>implicitSolventSaltConc=0.1*u.liters/u.mole</code> indicates that we want to model a ca. 0.1 molar solution of monovalent ions using a Debye screening model.</li>
</ul><p>See the API documentation for the <code>chemistry</code> package (<a href="../../chemistry/chemistry.amber.html#module-chemistry.amber.openmmloader">available here</a>) for a full listing of available options.  If there are any other force objects you want to define, they can be added to the system after this step (like, for instance, positional restraints to a reference structure).</p>

<h3>
<a name="create-the-integrator-to-do-langevin-dynamics" class="anchor" href="#create-the-integrator-to-do-langevin-dynamics"><span class="octicon octicon-link"></span></a>Create the integrator to do Langevin Dynamics</h3>

<p>In this stage we specify an integrator. Common choices are <code>LangevinIntegrator</code> (as we've chosen here) to do simulations in the NVT ensemble and <code>VerletIntegrator</code> that allows us to do simulations either at constant energy or temperature if using the <code>AndersenThermostat</code>.  In this example, we've chosen the Langevin integrator with a target temperature of 300 K, a friction coefficient of 1/ps and a time step of 2 fs.</p>

<h3>
<a name="define-the-platform" class="anchor" href="#define-the-platform"><span class="octicon octicon-link"></span></a>Define the platform</h3>

<p>In this stage, we define the platform we want to use.  In this example we have chosen the CUDA platform, but this may not be available on every machine since it only runs on NVidia GPU hardware.  Other choices are OpenCL (which will run on a variety of GPUs including those made by AMD/ATI and CPUs), CPU (which is an optimized version that runs natively on CPUs), and Reference (often quite slow).</p>

<p>The properties can be set for each platform. In this case, we specified that we wanted to use a mixed precision model (a good compromise between speed and precision).</p>

<h3>
<a name="create-the-simulation-object" class="anchor" href="#create-the-simulation-object"><span class="octicon octicon-link"></span></a>Create the Simulation object</h3>

<p>This step creates a <code>Simulation</code> object that will be used to run the actual simulations.  If we wanted OpenMM to simply pick the fastest platform for us (rather than specify one directly), we could omit the 
<code>platform</code> and <code>prop</code> arguments.</p>

<h3>
<a name="set-the-particle-positions" class="anchor" href="#set-the-particle-positions"><span class="octicon octicon-link"></span></a>Set the particle positions</h3>

<p>This stage is very important.  In this step, we set the particle positions stored in the <code>ala5_gas</code> object to our object.  If you omit this step, you can get strange results or other errors like segmentation violations.  These particle positions have been parsed from the input coordinate file, although if you had a PDB file you could use the OpenMM <code>PDBFile</code> object as a source of coordinates instead.</p>

<h3>
<a name="minimize-the-energy" class="anchor" href="#minimize-the-energy"><span class="octicon octicon-link"></span></a>Minimize the energy</h3>

<p>This stage performs a basic energy minimization to relax particle positions.  This particular invocation will perform at most 500 iterations.</p>

<h3>
<a name="set-up-the-reporters" class="anchor" href="#set-up-the-reporters"><span class="octicon octicon-link"></span></a>Set up the reporters</h3>

<p>This stage defines reporters that will "report" on the status of the simulation periodically throughout the simulation. The first is an <code>AmberStateDataReporter</code> which will print out a summary of energies and temperatures every 100 steps.  Unlike the <code>StateDataReporter</code> in OpenMM, this reporter prints values in the AKMA unit system (Angstrom, Kilocalorie per mole, and atomic mass units).  This reporter directs the printout to standard output (the screen), <code>sys.stdout</code> can be replaced with a different file-like object or a file name.</p>

<p>The second reporter is a NetCDF trajectory reporter, which is written in the Amber NetCDF format.  You can also use the native <code>DCDReporter</code> reporter in OpenMM to print DCD-format trajectories.</p>

<h3>
<a name="running-dynamics" class="anchor" href="#running-dynamics"><span class="octicon octicon-link"></span></a>Running dynamics</h3>

<p>This is the stage that actually runs the MD.  In this case, we are running 10,000 steps of MD.  The wiki page with "Common recipes" has information regarding running a long simulation in chunks.</p>

<h2>
<a name="explicit-solvent" class="anchor" href="#explicit-solvent"><span class="octicon octicon-link"></span></a>Explicit solvent</h2>

<p>For the purposes of this example, we are using an alanine dipeptide solvated in a box of water.  You can download the files using the following links (or see the same files in the <code>examples/amber</code> directory of the ParmEd release):</p>

<ul>
<li>
<a href="ala2_solv.parm7">ala2_solv.parm7</a> : The input parameter/topology file</li>
<li>
<a href="ala2_solv.rst7">ala2_solv.rst7</a> : The input coordinate file</li>
</ul><p>The following sample script (<code>simulate_amber_pme.py</code> in the ParmEd release) will set up and run the simulation using OpenMM:</p>

<div class="highlight highlight-Python"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># OpenMM Imports</span>
<span class="kn">import</span> <span class="nn">simtk.unit</span> <span class="kn">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">simtk.openmm</span> <span class="kn">as</span> <span class="nn">mm</span>
<span class="kn">import</span> <span class="nn">simtk.openmm.app</span> <span class="kn">as</span> <span class="nn">app</span>

<span class="c"># ParmEd Imports</span>
<span class="kn">from</span> <span class="nn">chemistry.amber.openmmloader</span> <span class="kn">import</span> <span class="n">OpenMMAmberParm</span> <span class="k">as</span> <span class="n">AmberParm</span>
<span class="kn">from</span> <span class="nn">chemistry.charmm.parameters</span> <span class="kn">import</span> <span class="n">CharmmParameterSet</span>
<span class="kn">from</span> <span class="nn">chemistry.amber.openmmreporters</span> <span class="kn">import</span> <span class="p">(</span><span class="n">AmberStateDataReporter</span><span class="p">,</span>
                                             <span class="n">NetCDFReporter</span><span class="p">)</span>

<span class="c"># Load the CHARMM files</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Loading AMBER files...'</span><span class="p">)</span>
<span class="n">ala2_solv</span> <span class="o">=</span> <span class="n">AmberParm</span><span class="p">(</span><span class="s">'ala2_solv.parm7'</span><span class="p">,</span> <span class="s">'ala2_solv.rst7'</span><span class="p">)</span>

<span class="c"># Create the OpenMM system</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Creating OpenMM System'</span><span class="p">)</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">ala2_solv</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">nonbondedMethod</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">PME</span><span class="p">,</span>
                                <span class="n">nonbondedCutoff</span><span class="o">=</span><span class="mf">8.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">,</span>
                                <span class="n">constraints</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">HBonds</span><span class="p">,</span>
<span class="p">)</span>

<span class="c"># Create the integrator to do Langevin dynamics</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">LangevinIntegrator</span><span class="p">(</span>
                        <span class="mi">300</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span>       <span class="c"># Temperature of heat bath</span>
                        <span class="mf">1.0</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">,</span>  <span class="c"># Friction coefficient</span>
                        <span class="mf">2.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">femtoseconds</span><span class="p">,</span> <span class="c"># Time step</span>
<span class="p">)</span>

<span class="c"># Define the platform to use; CUDA, OpenCL, CPU, or Reference. Or do not specify</span>
<span class="c"># the platform to use the default (fastest) platform</span>
<span class="n">platform</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">Platform</span><span class="o">.</span><span class="n">getPlatformByName</span><span class="p">(</span><span class="s">'CUDA'</span><span class="p">)</span>
<span class="n">prop</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">CudaPrecision</span><span class="o">=</span><span class="s">'mixed'</span><span class="p">)</span> <span class="c"># Use mixed single/double precision</span>

<span class="c"># Create the Simulation object</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">ala2_solv</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">,</span> <span class="n">platform</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>

<span class="c"># Set the particle positions</span>
<span class="n">sim</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">ala2_solv</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>

<span class="c"># Minimize the energy</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Minimizing energy'</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">minimizeEnergy</span><span class="p">(</span><span class="n">maxIterations</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="c"># Set up the reporters to report energies and coordinates every 100 steps</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">AmberStateDataReporter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">potentialEnergy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                              <span class="n">kineticEnergy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                              <span class="n">volume</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">NetCDFReporter</span><span class="p">(</span><span class="s">'ala2_solv.nc'</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">crds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="c"># Run dynamics</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Running dynamics'</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>

<p>Now we'll dissect the script to help you understand what is happening at each step.  We will divide the script into the sections following the <code>print</code> statements that announce when each stage begins.</p>

<h3>
<a name="loading-amber-files-1" class="anchor" href="#loading-amber-files-1"><span class="octicon octicon-link"></span></a>Loading Amber files</h3>

<p>In this stage, we simply instantiate the <code>AmberParm</code> object from the input topology and coordinate files. After this command, <code>ala2_solv</code> will contain a full description of every particle, the parameters defining their interactions, and their positions.</p>

<h3>
<a name="create-the-openmm-system-1" class="anchor" href="#create-the-openmm-system-1"><span class="octicon octicon-link"></span></a>Create the OpenMM system</h3>

<p>This command creates an OpenMM <code>System</code> object from the information stored in <code>ala5_gas</code>. It contains multiple <code>Force</code> instances for the bonds, angles, periodic torsions, and nonbonded (electrostatic and van der Waals) interactions.  It is in this function that we define the potential parameters we want to use. In this example, we have chosen the default values for each parameter except the ones specified. In particular:</p>

<ul>
<li>
<code>nonbondedMethod=app.PME</code> indicates we want to use the Particle Mesh Ewald method to compute the full-range electrostatics.</li>
<li>
<code>nonbondedCutoff=8.0*u.angstroms</code> indicates we want to use an 8 Angstrom cutoff for the Lennard-Jones interaction (as well as the direct-space part of the Ewald sum).</li>
<li>
<code>constraints=app.HBonds</code> indicates that we want to constrain all bonds in which at least one atom is hydrogen</li>
</ul><p>See the API documentation for the <code>chemistry</code> package (<a href="../../chemistry/chemistry.amber.html#module-chemistry.amber.openmmloader">available here</a>) for a full listing of available options.  If there are any other force objects you want to define, they can be added to the system after this step (like, for instance, positional restraints to a reference structure).</p>

<h3>
<a name="create-the-integrator-to-do-langevin-dynamics-1" class="anchor" href="#create-the-integrator-to-do-langevin-dynamics-1"><span class="octicon octicon-link"></span></a>Create the integrator to do Langevin Dynamics</h3>

<p>In this stage we specify an integrator. Common choices are <code>LangevinIntegrator</code> (as we've chosen here) to do simulations in the NVT ensemble and <code>VerletIntegrator</code> that allows us to do simulations either at constant energy or temperature if using the <code>AndersenThermostat</code>.  In this example, we've chosen the Langevin integrator with a target temperature of 300 K, a friction coefficient of 1/ps and a time step of 2 fs.</p>

<h3>
<a name="define-the-platform-1" class="anchor" href="#define-the-platform-1"><span class="octicon octicon-link"></span></a>Define the platform</h3>

<p>In this stage, we define the platform we want to use.  In this example we have chosen the CUDA platform, but this may not be available on every machine since it only runs on NVidia GPU hardware.  Other choices are OpenCL (which will run on a variety of GPUs including those made by AMD/ATI and CPUs), CPU (which is an optimized version that runs natively on CPUs), and Reference (often quite slow).</p>

<p>The properties can be set for each platform. In this case, we specified that we wanted to use a mixed precision model (a good compromise between speed and precision).</p>

<h3>
<a name="create-the-simulation-object-1" class="anchor" href="#create-the-simulation-object-1"><span class="octicon octicon-link"></span></a>Create the Simulation object</h3>

<p>This step creates a <code>Simulation</code> object that will be used to run the actual simulations.  If we wanted OpenMM to simply pick the fastest platform for us (rather than specify one directly), we could omit the 
<code>platform</code> and <code>prop</code> arguments.</p>

<h3>
<a name="set-the-particle-positions-1" class="anchor" href="#set-the-particle-positions-1"><span class="octicon octicon-link"></span></a>Set the particle positions</h3>

<p>This stage is very important.  In this step, we set the particle positions stored in the <code>ala5_gas</code> object to our object.  If you omit this step, you can get strange results or other errors like segmentation violations.  These particle positions have been parsed from the input coordinate file, although if you had a PDB file you could use the OpenMM <code>PDBFile</code> object as a source of coordinates instead.</p>

<h3>
<a name="minimize-the-energy-1" class="anchor" href="#minimize-the-energy-1"><span class="octicon octicon-link"></span></a>Minimize the energy</h3>

<p>This stage performs a basic energy minimization to relax particle positions.  This particular invocation will perform at most 500 iterations.</p>

<h3>
<a name="set-up-the-reporters-1" class="anchor" href="#set-up-the-reporters-1"><span class="octicon octicon-link"></span></a>Set up the reporters</h3>

<p>This stage defines reporters that will "report" on the status of the simulation periodically throughout the simulation. The first is an <code>AmberStateDataReporter</code> which will print out a summary of energies and temperatures every 100 steps.  Unlike the <code>StateDataReporter</code> in OpenMM, this reporter prints values in the AKMA unit system (Angstrom, Kilocalorie per mole, and atomic mass units).</p>

<p>The second reporter is a NetCDF trajectory reporter, which is written in the Amber NetCDF format.  You can also use the native <code>DCDReporter</code> reporter in OpenMM to print DCD-format trajectories.</p>

<h3>
<a name="running-dynamics-1" class="anchor" href="#running-dynamics-1"><span class="octicon octicon-link"></span></a>Running dynamics</h3>

<p>This is the stage that actually runs the MD.  In this case, we are running 10,000 steps of MD.  The wiki page of <a href="https://github.com/swails/ParmEd/wiki/OpenMM-Tricks-And-Recipes">Common recipes (click here)</a> has information regarding running a long simulation in chunks.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">ParmEd maintained by <a href="https://github.com/swails">swails</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
